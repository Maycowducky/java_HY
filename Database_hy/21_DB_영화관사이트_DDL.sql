DROP DATABASE IF EXISTS CGV;

CREATE DATABASE CGV;

USE CGV;

DROP TABLE IF EXISTS `MOVIE`;

CREATE TABLE `MOVIE` (
	`MO_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`MO_TITLE`	VARCHAR(50) NOT NULL,
	`MO_TITLE_ENG`	VARCHAR(100) NOT NULL,
	`MO_OPENING_DATE`	DATE NULL,
	`MO_RUNNING_TIME`	INT	NOT NULL,
	`MO_PLOT`	LONGTEXT NOT NULL,
	`MO_FI_NUM`	INT	NOT NULL,
	`MO_AG_NAME`	VARCHAR(10)	NOT NULL,
	`MO_RESERVATION_RATE`	INT	NOT NULL DEFAULT 0
);

DROP TABLE IF EXISTS `GENRE`;

CREATE TABLE `GENRE` (
	`GE_NAME`	VARCHAR(10)	NOT NULL PRIMARY KEY
);

DROP TABLE IF EXISTS `MOVIE_GENRE`;

CREATE TABLE `MOVIE_GENRE` (
	`MG_NUM`	INT PRIMARY KEY AUTO_INCREMENT	NOT NULL,
	`MG_GE_NAME`	VARCHAR(10)	NOT NULL,
	`MG_MO_NUM`	INT NOT NULL
);

DROP TABLE IF EXISTS `COUNTRY`;

CREATE TABLE `COUNTRY` (
	`CT_NAME`	VARCHAR(20)	NOT NULL PRIMARY KEY
);

DROP TABLE IF EXISTS `COUNTRY_PRODUCTION`;

CREATE TABLE `COUNTRY_PRODUCTION` (
	`CP_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`CP_CT_NAME`	VARCHAR(20)	NOT NULL,
	`CP_MO_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `FILM_PERSON`;

CREATE TABLE `FILM_PERSON` (
	`FP_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`FP_NAME`	VARCHAR(20)	NOT NULL,
	`FP_THUMB`	VARCHAR(50)	NULL,
	`FP_AGENCY`	VARCHAR(20)	NULL,
	`FP_FINAL_EDUCATION`	VARCHAR(20)	NULL,
	`FP_BIRTHDAY`	DATE NOT NULL,
	`FP_CT_NAME`	VARCHAR(20)	NOT NULL
);

DROP TABLE IF EXISTS `ROLE`;

CREATE TABLE `ROLE` (
	`RO_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`RO_ROLE`	VARCHAR(30)	NOT NULL,
	`RO_FP_NUM`	INT	NOT NULL,
	`RO_MO_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `FILE`;

CREATE TABLE `FILE` (
	`FI_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`FI_NAME`	VARCHAR(100)	NOT NULL,
	`FI_STATE`	VARCHAR(10)	NOT NULL -- 메인포스트 / 트레일러 / 스틸컷
);

DROP TABLE IF EXISTS `MOVIE_FILE`;

CREATE TABLE `MOVIE_FILE` (
	`MF_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`MF_FI_NUM`	INT	NOT NULL,
	`MF_MO_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `AGE`;

CREATE TABLE `AGE` (
	`AG_NAME`	VARCHAR(10)	NOT NULL PRIMARY KEY
);

DROP TABLE IF EXISTS `THEATER`;

CREATE TABLE `THEATER` (
	`TH_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`TH_NAME`	VARCHAR(20)	NOT NULL,
	`TH_ADDRESS`	VARCHAR(50) NOT	NULL,
	`TH_RE_NAME`	VARCHAR(15)	NOT NULL,
	`TH_TOTAL_SCREEN`	INT	NOT NULL DEFAULT 1,
	`TH_TOTAL_SEAT`	INT	NOT NULL
);

DROP TABLE IF EXISTS `REGION`;

CREATE TABLE `REGION` (
	`RE_NAME`	VARCHAR(15)	NOT NULL PRIMARY KEY
);

DROP TABLE IF EXISTS `SCREEN`;

CREATE TABLE `SCREEN` (
	`SC_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`SC_NAME`	VARCHAR(20)	NOT NULL,
	`SC_TOTAL_SEAT`	INT	NOT NULL,
	`SC_TH_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `SEAT`;

CREATE TABLE `SEAT` (
	`SE_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`SE_NAME`	VARCHAR(4)	NOT NULL,
	`SE_ROW`	CHAR(1)	NOT NULL,
	`SE_COL`	VARCHAR(2)	NOT NULL,
	`SE_STATE`	VARCHAR(10)	NOT NULL DEFAULT '일반', -- 일반/커플/VIP
	`SE_SC_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `MOVIE_SCHEDULE`;

CREATE TABLE `MOVIE_SCHEDULE` (
	`MS_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`MS_MO_NUM`	INT	NOT NULL,
	`MS_SC_NUM`	INT	NOT NULL,
	`MS_DATE`	DATE	NOT NULL,
	`MS_START_TIME`	TIME	NOT NULL,
	`MS_END_TIME`	TIME	NOT NULL,
	`MS_POSSIBLE_SEAT`	INT	NOT NULL,
	`MS_DISCOUNT`	CHAR(1)	NOT NULL DEFAULT 'N'
);

DROP TABLE IF EXISTS `MEMBER`;

CREATE TABLE `MEMBER` (
	`ME_ID`	VARCHAR(15)	NOT NULL PRIMARY KEY,
	`ME_PW`	VARCHAR(20)	NOT NULL,
	`ME_NAME`	VARCHAR(20)	NOT NULL,
	`ME_PHONE`	VARCHAR(20)	NOT NULL,
	`ME_BIRTHDAY`	DATE	NOT NULL
);

DROP TABLE IF EXISTS `RESERVATION`;

CREATE TABLE `RESERVATION` (
	`RV_NUM`	VARCHAR(30)	NOT NULL PRIMARY KEY,
	`RV_ADULT`	INT	NOT NULL DEFAULT 0,
	`RV_TEENAGER`	INT	NOT NULL DEFAULT 0,
	`RV_PRICE`	INT	NOT NULL,
	`RV_ME_ID`	VARCHAR(15)	NOT NULL,
	`RV_MS_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `RESERVATION_LIST`;

CREATE TABLE `RESERVATION_LIST` (
	`RL_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`RL_RV_NUM`	VARCHAR(30)	NOT NULL,
	`RL_SE_NUM`	INT	NOT NULL,
	`RL_PR_NUM`	INT	NOT NULL
);

DROP TABLE IF EXISTS `PRICE`;

CREATE TABLE `PRICE` (
	`PR_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`PR_TYPE`	VARCHAR(3)	NOT NULL,
	`PR_PRICE`	INT	NOT NULL,
	`PR_DISCOUNT_PRICE`	INT	NOT NULL
);

DROP TABLE IF EXISTS `REVIEW`;

CREATE TABLE `REVIEW` (
	`RE_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`RE_CONTENT`	LONGTEXT	NOT NULL,
	`RE_MO_NUM`	INT	NOT NULL,
	`RE_ME_ID`	VARCHAR(15)	NOT NULL,
	`RE_TOTAL_LIKE`	INT	NOT NULL DEFAULT 0
);

DROP TABLE IF EXISTS `LIKE`;

CREATE TABLE `LIKE` (
	`LI_NUM`	INT	NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`LI_ME_ID`	VARCHAR(15)	NOT NULL,
	`LI_RE_NUM`	INT	NOT NULL
);

ALTER TABLE `MOVIE` ADD CONSTRAINT `FK_FILE_TO_MOVIE_1` FOREIGN KEY (
	`MO_FI_NUM`
)
REFERENCES `FILE` (
	`FI_NUM`
);

ALTER TABLE `MOVIE` ADD CONSTRAINT `FK_AGE_TO_MOVIE_1` FOREIGN KEY (
	`MO_AG_NAME`
)
REFERENCES `AGE` (
	`AG_NAME`
);

ALTER TABLE `MOVIE_GENRE` ADD CONSTRAINT `FK_GENRE_TO_MOVIE_GENRE_1` FOREIGN KEY (
	`MG_GE_NAME`
)
REFERENCES `GENRE` (
	`GE_NAME`
);

ALTER TABLE `MOVIE_GENRE` ADD CONSTRAINT `FK_MOVIE_TO_MOVIE_GENRE_1` FOREIGN KEY (
	`MG_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `COUNTRY_PRODUCTION` ADD CONSTRAINT `FK_COUNTRY_TO_COUNTRY_PRODUCTION_1` FOREIGN KEY (
	`CP_CT_NAME`
)
REFERENCES `COUNTRY` (
	`CT_NAME`
);

ALTER TABLE `COUNTRY_PRODUCTION` ADD CONSTRAINT `FK_MOVIE_TO_COUNTRY_PRODUCTION_1` FOREIGN KEY (
	`CP_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `FILM_PERSON` ADD CONSTRAINT `FK_COUNTRY_TO_FILM_PERSON_1` FOREIGN KEY (
	`FP_CT_NAME`
)
REFERENCES `COUNTRY` (
	`CT_NAME`
);

ALTER TABLE `ROLE` ADD CONSTRAINT `FK_FILM_PERSON_TO_ROLE_1` FOREIGN KEY (
	`RO_FP_NUM`
)
REFERENCES `FILM_PERSON` (
	`FP_NUM`
);

ALTER TABLE `ROLE` ADD CONSTRAINT `FK_MOVIE_TO_ROLE_1` FOREIGN KEY (
	`RO_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `MOVIE_FILE` ADD CONSTRAINT `FK_FILE_TO_MOVIE_FILE_1` FOREIGN KEY (
	`MF_FI_NUM`
)
REFERENCES `FILE` (
	`FI_NUM`
);

ALTER TABLE `MOVIE_FILE` ADD CONSTRAINT `FK_MOVIE_TO_MOVIE_FILE_1` FOREIGN KEY (
	`MF_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `THEATER` ADD CONSTRAINT `FK_REGION_TO_THEATER_1` FOREIGN KEY (
	`TH_RE_NAME`
)
REFERENCES `REGION` (
	`RE_NAME`
);

ALTER TABLE `SCREEN` ADD CONSTRAINT `FK_THEATER_TO_SCREEN_1` FOREIGN KEY (
	`SC_TH_NUM`
)
REFERENCES `THEATER` (
	`TH_NUM`
);

ALTER TABLE `SEAT` ADD CONSTRAINT `FK_SCREEN_TO_SEAT_1` FOREIGN KEY (
	`SE_SC_NUM`
)
REFERENCES `SCREEN` (
	`SC_NUM`
);

ALTER TABLE `MOVIE_SCHEDULE` ADD CONSTRAINT `FK_MOVIE_TO_MOVIE_SCHEDULE_1` FOREIGN KEY (
	`MS_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `MOVIE_SCHEDULE` ADD CONSTRAINT `FK_SCREEN_TO_MOVIE_SCHEDULE_1` FOREIGN KEY (
	`MS_SC_NUM`
)
REFERENCES `SCREEN` (
	`SC_NUM`
);

ALTER TABLE `RESERVATION` ADD CONSTRAINT `FK_MEMBER_TO_RESERVATION_1` FOREIGN KEY (
	`RV_ME_ID`
)
REFERENCES `MEMBER` (
	`ME_ID`
);

ALTER TABLE `RESERVATION` ADD CONSTRAINT `FK_MOVIE_SCHEDULE_TO_RESERVATION_1` FOREIGN KEY (
	`RV_MS_NUM`
)
REFERENCES `MOVIE_SCHEDULE` (
	`MS_NUM`
);

ALTER TABLE `RESERVATION_LIST` ADD CONSTRAINT `FK_RESERVATION_TO_RESERVATION_LIST_1` FOREIGN KEY (
	`RL_RV_NUM`
)
REFERENCES `RESERVATION` (
	`RV_NUM`
);

ALTER TABLE `RESERVATION_LIST` ADD CONSTRAINT `FK_SEAT_TO_RESERVATION_LIST_1` FOREIGN KEY (
	`RL_SE_NUM`
)
REFERENCES `SEAT` (
	`SE_NUM`
);

ALTER TABLE `RESERVATION_LIST` ADD CONSTRAINT `FK_PRICE_TO_RESERVATION_LIST_1` FOREIGN KEY (
	`RL_PR_NUM`
)
REFERENCES `PRICE` (
	`PR_NUM`
);

ALTER TABLE `REVIEW` ADD CONSTRAINT `FK_MOVIE_TO_REVIEW_1` FOREIGN KEY (
	`RE_MO_NUM`
)
REFERENCES `MOVIE` (
	`MO_NUM`
);

ALTER TABLE `REVIEW` ADD CONSTRAINT `FK_MEMBER_TO_REVIEW_1` FOREIGN KEY (
	`RE_ME_ID`
)
REFERENCES `MEMBER` (
	`ME_ID`
);

ALTER TABLE `LIKE` ADD CONSTRAINT `FK_MEMBER_TO_LIKE_1` FOREIGN KEY (
	`LI_ME_ID`
)
REFERENCES `MEMBER` (
	`ME_ID`
);

ALTER TABLE `LIKE` ADD CONSTRAINT `FK_REVIEW_TO_LIKE_1` FOREIGN KEY (
	`LI_RE_NUM`
)
REFERENCES `REVIEW` (
	`RE_NUM`
);

